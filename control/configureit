#
# configuration used for development purposes on Linux and Mac OS X
#
CFLAGS="-Wall -g -O2"
CXXFLAGS="-fuse-cxa-atexit ${CFLAGS}"
export CFLAGS CXXFLAGS
commonflags="--enable-unittests"

# first find out what type of system we are
systemtype=`uname`
case ${systemtype} in
Darwin)	echo "configuring for Mac OS X"
	;;
Linux)	if [ -r /etc/debian_version ]
	then
		echo "configuring for Debian"
		systemtype=Debian
	else
		if [ -r /etc/SuSE-release ]
		then
			echo "configuring for SuSE"
			systemtype=SuSE
		else
			echo "configuring for unspecified Linux (cross your fingers)"
		fi
	fi
	# find out whether we should try to build the sbig driver
	if [ -r /usr/local/lib64/libsbigudrv.so -a -r /usr/local/include/sbigudrv.h ]
	then
		sbigoption=--enable-sbig
	else
		sbigoption=
	fi
	;;
esac


# the -fuse-cxa-atexit seems to be necessary for dynamically loaded 
# C++ modules, but I'm not convinced. The tests still crash when
# unloading the modules
case ${systemtype} in
Linux)
	./configure --prefix=`pwd`/root ${commonflags}
	;;
Debian)
	./configure --prefix=`pwd`/root ${commonflags}
	;;
SuSE)
	LDFLAGS="-L/usr/local/lib64 -lusb-1.0"
	if [ -d /usr/include/unicap ]
	then
		CFLAGS="${CFLAGS} -I/usr/include/unicap"
		CXXFLAGS="${CXXFLAGS} -I/usr/include/unicap"
	else if [ -d /usr/local/include/unicap ]
		then
			CFLAGS="${CFLAGS} -I/usr/local/include/unicap"
			CXXFLAGS="${CXXFLAGS} -I/usr/local/include/unicap"
		fi
	fi
	export LDFLAGS CFLAGS CXXFLAGS

	./configure --prefix=`pwd`/root ${commonflags} --enable-unicap \
		${sbigoption}
	;;
Darwin)
	LDFLAGS="-L/usr/local/lib -lusb-1.0"
	export CFLAGS CXXFLAGS LDFLAGS
	./configure --prefix=`pwd`/root ${commonflags} --enable-uvc \
		--enable-sbig
	;;
esac
